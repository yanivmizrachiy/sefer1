<!doctype html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>השתלמויות של יניב רז</title>
    <meta
      name="description"
      content="ריכוז ההשתלמויות של יניב רז לפי תאריך, יום בשבוע ושעות."
    />
    <link rel="stylesheet" href="./styles.css?v=1" />
  </head>
  <body>
    <div class="bg" aria-hidden="true"></div>
    <main class="page">
      <header class="page__header">
        <h1 class="page__title">השתלמויות של יניב רז</h1>
        <a class="page__back" href="./index.html">← חזרה לעמוד הראשי</a>
      </header>
      <p class="page__meta">
        בעמוד זה מופיע ריכוז ההשתלמויות של יניב רז לפי תאריך, יום בשבוע ושעות. הנתונים נטענים
        מקובץ נתונים בתוך האתר:
        <code>אתר/hishtalmut-data.json</code>.
      </p>

      <div class="table-wrap">
        <table id="hishtalmut-table" aria-label="טבלת ההשתלמויות של יניב רז">
          <thead>
            <tr>
              <th>שם ההשתלמות</th>
              <th>חודש</th>
              <th>יום בחודש</th>
              <th>יום בשבוע</th>
              <th>שעות ההשתלמות</th>
              <th>מספר שעות</th>
              <th>סיווג / תגיות</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <p id="state-empty" class="state" style="display: none">
        עדיין לא הוגדרו נתוני השתלמויות ב-<code>אתר/hishtalmut-data.json</code>.
      </p>
      <p id="state-error" class="state state--error" style="display: none">
        לא ניתן היה לטעון את נתוני ההשתלמויות. ודא שהקובץ
        <code>אתר/hishtalmut-data.json</code> קיים ותקין.
      </p>
    </main>

    <script>
      async function loadHishtalmutData() {
        const tbody = document.querySelector("#hishtalmut-table tbody");
        const emptyState = document.getElementById("state-empty");
        const errorState = document.getElementById("state-error");

        try {
          const res = await fetch("./hishtalmut-data.json?cacheBust=" + Date.now());
          if (!res.ok) {
            if (res.status === 404) {
              emptyState.style.display = "block";
              return;
            }
            throw new Error("HTTP " + res.status);
          }

          const data = await res.json();
          if (!Array.isArray(data) || data.length === 0) {
            emptyState.style.display = "block";
            return;
          }

          data.forEach((item) => {
            const tr = document.createElement("tr");

            const tdTitle = document.createElement("td");
            tdTitle.textContent = item.title || "";
            tr.appendChild(tdTitle);

            const tdMonth = document.createElement("td");
            tdMonth.textContent = item.month || "";
            tr.appendChild(tdMonth);

            const tdDayOfMonth = document.createElement("td");
            tdDayOfMonth.textContent = item.dayOfMonth ?? "";
            tr.appendChild(tdDayOfMonth);

            const tdWeekday = document.createElement("td");
            tdWeekday.textContent = item.weekday || "";
            tr.appendChild(tdWeekday);

            const tdTimeRange = document.createElement("td");
            tdTimeRange.textContent = item.timeRange || "";
            tr.appendChild(tdTimeRange);

            const tdHoursTotal = document.createElement("td");
            tdHoursTotal.textContent =
              item.hoursTotal !== undefined && item.hoursTotal !== null ? item.hoursTotal : "";
            tr.appendChild(tdHoursTotal);

            const tdCategory = document.createElement("td");
            if (item.category) {
              const mainTag = document.createElement("span");
              mainTag.className = "tag tag--main";
              mainTag.textContent = item.category;
              tdCategory.appendChild(mainTag);
            }
            if (Array.isArray(item.tags)) {
              item.tags.forEach((tag) => {
                const span = document.createElement("span");
                span.className = "tag";
                span.textContent = tag;
                tdCategory.appendChild(span);
              });
            }
            tr.appendChild(tdCategory);

            tbody.appendChild(tr);
          });
        } catch (err) {
          console.error("Failed to load hishtalmut data", err);
          errorState.style.display = "block";
        }
      }

      loadHishtalmutData();
    </script>
  </body>
</html>
